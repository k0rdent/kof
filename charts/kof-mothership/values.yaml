global:
  # -- Name of the label identifying where the time series data points come from.
  clusterLabel: cluster
  # -- Value of clusterName usually identical to cluster used in some subcharts (e.g. otel)
  clusterName: mothership
  # -- Name of the storage class used by Grafana (if enabled),
  # `vmstorage` (long-term storage of raw time series data),
  # and `vmselect` (cache of query results).
  # Keep it unset or empty to leverage the advantages of
  # [default storage class](https://kubernetes.io/docs/concepts/storage/storage-classes/#default-storageclass).
  storageClass: ""

  # -- Length of the auto-generated usernames for Grafana (if enabled) and VictoriaMetrics.
  random_username_length: 8

  # -- Length of the auto-generated passwords for Grafana (if enabled) and VictoriaMetrics.
  random_password_length: 12

  # -- Custom image registry, `sveltos-dashboard` requires not empty value.
  registry: docker.io

cert-manager:
  # -- Whether cert-manager is present in the cluster
  enabled: true
  cluster-issuer:
    # -- Whether to create a default clusterissuer
    create: false
    # -- Default clusterissuer provider
    provider: letsencrypt
  # -- If we use letsencrypt (or similar) which email to use
  email: mail@example.net

istio:
  # -- Installs resources required for the KOF to work properly with the main Istio chart.
  enabled: true

# -- Config of `ServiceTemplate` to use `cert-manager` in `MultiClusterService`.
cert-manager-service-template:
  repo:
    name: cert-manager
    url: https://charts.jetstack.io
  chart: cert-manager:v1.16.4
  namespace: kcm-system
  enabled: true

# -- Config of `ServiceTemplate` to use `ingress-nginx` in `MultiClusterService`.
ingress-nginx-service-template:
  repo:
    name: ingress-nginx
    url: https://kubernetes.github.io/ingress-nginx
  chart: ingress-nginx:4.12.1
  namespace: kcm-system

kcm:
  # -- K8s namespace created on installation of k0rdent/kcm.
  namespace: kcm-system

  # -- Installs `ServiceTemplates` to use charts like `kof-storage` in `MultiClusterService`.
  installTemplates: false

  serviceMonitor:
    # -- Enables the "KCM Controller Manager" Grafana dashboard.
    enabled: true

  kof:
    # -- Repo of `kof-*` helm charts.
    repo:
      name: oci-registry
      spec:
        type: oci
        url: oci://ghcr.io/k0rdent/kof/charts

    # -- Names of secrets auto-distributed to clusters with matching labels.
    mcs:
      # kof-storage-secrets:
      #   matchLabels:
      #     k0rdent.mirantis.com/kof-storage-secrets: "true"
      #   secrets:
      #     - storage-vmuser-credentials

    # -- Generation of secrets used by kof components.
    # Generate random username/password if secret not found.
    secrets:
      kof-storage-secrets:
        # htpasswdFrom: storage-vmuser-credentials
        secrets:
          - storage-vmuser-credentials

    operator:
      # -- Enables the `kof-operator`.
      enabled: true

      # -- Number of the `kof-operator` deployment replicas.
      replicaCount: 1

      # -- Allows regional cluster to be in another namespace than the child cluster.
      crossNamespace: false

      rbac:
        # -- Creates the `kof-mothership-kof-operator` cluster role
        # and binds it to the service account of operator.
        create: true

      # -- Image of the kof operator.
      image:
        registry: ghcr.io/k0rdent
        repository: kof/kof-operator-controller
        pullPolicy: IfNotPresent

      resources:
        # -- Minimum resources required for operator.
        requests:
          cpu: 100m
          memory: 128Mi

        # -- Maximum resources available for operator.
        limits:
          cpu: 100m
          memory: 128Mi

      autoinstrumentation:
        # -- Enable autoinstrumentation to collect metrics and traces from the operator.
        enabled: true

      serviceAccount:
        # -- Creates a service account for operator.
        create: true

        # -- Annotations for the service account of operator.
        annotations: {}

        # -- Name for the service account of operator.
        # If not set, it is generated as `kof-mothership-kof-operator`.
        name:

      ui:
        # -- Port for the web UI server.
        port: 9090

        # -- Port for Prometheus metrics receiver.
        receiverPort: 9090
      
      acl:
        # -- Image of the kof ACL server.
        image:
          registry: ghcr.io/k0rdent
          repository: kof/kof-acl-server
          pullPolicy: IfNotPresent

        # -- Port for ACL server.
        port: 9091

        # WARNING: Development only!
        # -- Enables development mode. Disables token verification and bypasses authentication,
        # granting admin access to the ACL server.
        developmentMode: true

        resources:
          # -- Minimum resources required for operator.
          requests:
            cpu: 100m
            memory: 128Mi

          # -- Maximum resources available for operator.
          limits:
            cpu: 100m
            memory: 128Mi


    # -- Config of `kof-mothership-kof-operator`
    # [Service](https://kubernetes.io/docs/concepts/services-networking/service/).
    service:
      enabled: true
      type: ClusterIP
      annotations: {}
      extraLabels: {}
      clusterIP: ""
      externalIPs: []
      loadBalancerIP: ""
      loadBalancerSourceRanges: []

    # -- Config of `kof-mothership-kof-operator-ui`
    # [Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/).
    ingress:
      enabled: false
      ingressClassName: nginx
      annotations: {}
      extraLabels: {}
      path: /
      pathType: Prefix
      hosts:
        - example.com
      tls: []

victoriametrics:
  # -- Enables VictoriaMetrics.
  enabled: true
  vmcluster:
    # -- Enables high-available and fault-tolerant version of VictoriaMetrics database.
    enabled: true
    # -- VMCluster object spec
    spec:
      license: {}
      # -- The number of replicas for each metric.
      replicationFactor: 1
      # -- Days to retain the data
      retentionPeriod: "1"

      vminsert:
        image:
          tag: v1.105.0-cluster
        port: "8480"
        # -- The number of replicas for vminsert
        replicaCount: 1
        podMetadata:
          labels:
            # -- Label to enable mtls
            k0rdent.mirantis.com/istio-mtls-enabled: "true"
            # -- Allows KOF UI to fetch internal metrics
            k0rdent.mirantis.com/kof-victoria-metrics: "true"
        extraArgs:
          maxLabelsPerTimeseries: "50"
      vmselect:
        cacheMountPath: /select-cache
        image:
          tag: v1.105.0-cluster
        port: "8481"
        # -- The number of replicas for vmselect
        replicaCount: 1
        podMetadata:
          labels:
            # -- Allows KOF UI to fetch internal metrics
            k0rdent.mirantis.com/kof-victoria-metrics: "true"
        resources: {}
        # The vmselect component is responsible for executing queries and may use caching to improve performance.
        # The storage size defined here is used to allocate space for caching query results.
        # More details: https://docs.victoriametrics.com/cluster-victoriametrics/
        storage:
          volumeClaimTemplate:
            spec:
              resources:
                requests:
                  # -- Query results cache size.
                  storage: 2Gi
      vmstorage:
        image:
          tag: v1.105.0-cluster
        replicaCount: 1
        resources: {}
        # The vmstorage component is used for the long-term storage of raw time series data.
        # The specified storage size should reflect the expected volume of data based on retention settings.
        # More details: https://docs.victoriametrics.com/cluster-victoriametrics/
        storage:
          volumeClaimTemplate:
            spec:
              resources:
                requests:
                  storage: 10Gi
        storageDataPath: /vm-data

  vmalert:
    # -- Enables VMAlertManager only, as VMAlert is replaced with promxy in kof-mothership.
    enabled: true

    # -- [VMAlertSpec](https://docs.victoriametrics.com/operator/api/#vmalertspec)
    spec:
      datasource:
        url: http://vmselect-cluster:8481/select/0/prometheus
      evaluationInterval: 15s
      extraArgs:
        http.pathPrefix: /
        remoteWrite.disablePathAppend: "true"
        "notifier.blackhole": "true"
      image:
        tag: v1.105.0
      configReloaderImageTag: jimmidyson/configmap-reload:v0.3.0
      port: "8080"
      remoteRead:
        url: http://vmselect-cluster:8481/select/0/prometheus
      remoteWrite:
        url: http://vminsert-cluster:8480/insert/0/prometheus/api/v1/write
      selectAllByDefault: true

    manager:
      # -- [VMAlertmanagerSpec](https://docs.victoriametrics.com/operator/api/#vmalertmanagerspec).
      spec:
        image:
          tag: v0.27.0
          repository: prom/alertmanager
        port: "9093"
        configReloaderImageTag: jimmidyson/configmap-reload:v0.3.0

grafana:
  # -- Enables Grafana.
  enabled: false

  ingress:
    # -- Enables an ingress to access Grafana without port-forwarding.
    enabled: false

    # -- Domain name Grafana will be available at.
    host: grafana.example.net

  # -- Old option to add `GrafanaDatasource`-s.
  logSources: []

  security:
    # -- Name of secret for Grafana username/password.
    credentials_secret_name: grafana-admin-credentials

    # -- Enables auto-creation of Grafana username/password.
    create_secret: true

  pvc:
    resources:
      requests:
        # -- Size of storage for Grafana.
        storage: 200Mi

  # -- Version of Grafana to use.
  version: "10.4.18-security-01"

kof-dashboards:
  grafana:
    dashboard:
      datasource:
        # -- Regex pattern to filter datasources.
        regex: "/kof-metrics/"

        # -- Values of current datasource
        current:
          text: kof-metrics
          value: kof-metrics

      # -- Values of filters to apply.
      filters:
        cluster: mothership

      # -- Enables istio dashboards
      istio_dashboard_enabled: true

dex:
  # -- Enables Dex.
  enabled: false

  image:
    # -- Version of Dex to use.
    tag: v2.42.1

  # -- Enables the HTTPS endpoint.
  https:
    enabled: true

  config:
    # -- The identifier (issuer) URL for Dex.
    issuer: https://dex.example.com:32000

    storage:
      # -- Specifies the storage type used by Dex.
      type: memory

    web:
      # -- Address and port for the HTTPS endpoint.
      https: 0.0.0.0:5554

      # -- Path to the TLS certificate file.
      tlsCert: /etc/dex/tls/tls.crt

      # -- Path to the TLS private key file.
      tlsKey: /etc/dex/tls/tls.key

    staticClients:
      - id: grafana-id
        redirectURIs:
          - "http://localhost:3000/login/generic_oauth"
        name: "Grafana"
        secret: grafana-secret

    connectors:
      - type: oidc
        id: google
        name: Google
        config:
          issuer: https://accounts.google.com
          clientID: ""
          clientSecret: ""
          redirectURI: https://dex.example.com:32000/callback
          insecureEnableGroups: true
          claimModifications:
            newGroupFromClaims:
            - prefix: "tenant"
              delimiter: ":"
              clearDelimiter: false
              claims:
                - hd
          scopes:
            - openid
            - email
            - profile

  volumes:
    - name: tls
      secret:
        secretName: dex-tls

  volumeMounts:
    - name: tls
      mountPath: /etc/dex/tls
      readOnly: true

  service:
    type: NodePort

    ports:
      http:
        port: 5556
      https:
        port: 5554
        nodePort: 32000

# -- [Docs](https://github.com/VictoriaMetrics/helm-charts/tree/master/charts/victoria-metrics-operator#parameters)
victoria-metrics-operator:
  enabled: true
  global:
    cluster:
      dnsDomain: cluster.local
  serviceMonitor:
    enabled: true
    vm: false
  operator:
    disable_prometheus_converter: true
  crds:
    plain: true
    cleanup:
      # CRDs cleanup is disabled to preserve CRDs and related vmstorage data
      # to avoid data loss during upgrades or uninstalls.
      enabled: false

# -- [Docs](https://github.com/kubernetes-sigs/metrics-server/blob/main/charts/metrics-server/README.md)
metrics-server:
  # -- Enables Metrics Server.
  enabled: false

# -- [Docs](https://github.com/Jont828/cluster-api-visualizer/tree/main/helm#configurable-values)
cluster-api-visualizer:
  enabled: true
  image:
    # -- Custom `cluster-api-visualizer` image repository.
    repository: ghcr.io/k0rdent

sveltos:
  # -- Creates `ServiceMonitor`-s for Sveltos `sc-manager` and `addon-controller`.
  serviceMonitors: true

  # -- Adds Sveltos dashboard to Grafana.
  grafanaDashboard: true

promxy:
  # -- Enables `kof-mothership-promxy` deployment.
  enabled: true

  # -- Number of replicated promxy pods.
  replicaCount: 1

  # -- Promxy image to use.
  image:
    registry: quay.io
    repository: jacksontj/promxy
    tag: v0.0.93
    pullPolicy: IfNotPresent

  serviceAccount:
    # -- Creates a service account for promxy.
    create: true

    # -- Annotations for the service account of promxy.
    annotations: {}

    # -- Name for the service account of promxy.
    # If not set, it is generated as `kof-mothership-promxy`.
    name:

  # -- Config of `kof-mothership-promxy`
  # [Service](https://kubernetes.io/docs/concepts/services-networking/service/).
  service:
    enabled: true
    type: ClusterIP
    servicePort: 8082
    annotations: {}
    extraLabels: {}
    clusterIP: ""
    externalIPs: []
    loadBalancerIP: ""
    loadBalancerSourceRanges: []

  # -- Config of `kof-mothership-promxy`
  # [Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/).
  ingress:
    enabled: false
    ingressClassName: nginx
    annotations: {}
    extraLabels: {}
    path: /
    pathType: Prefix
    hosts:
      - example.com
    tls: []

  resources:
    # -- Minimum resources required for the `promxy` container
    # in the pods of `kof-mothership-promxy` deployment.
    requests:
      cpu: 100m
      memory: 512Mi

    # -- Maximum resources available for the `promxy` container
    # in the pods of `kof-mothership-promxy` deployment.
    limits:
      cpu: 1000m
      memory: 512Mi

  # -- Extra command line arguments passed as `--key=value` to the `/bin/promxy`.
  extraArgs:
    log-level: "info"
    "web.external-url": http://127.0.0.1:8082

  configmapReload:
    resources:
      # -- Minimum resources required for the `promxy-server-configmap-reload` container
      # in the pods of `kof-mothership-promxy` deployment.
      requests:
        cpu: 0.02
        memory: 20Mi

      # -- Maximum resources available for the `promxy-server-configmap-reload` container
      # in the pods of `kof-mothership-promxy` deployment.
      limits:
        cpu: 0.02
        memory: 20Mi

# See ./templates/prometheus/_README.md
# @ignored
kube-state-metrics:
  enabled: true
# @ignored
kubeApiServer:
  enabled: true
# @ignored
kubeControllerManager:
  enabled: true
# @ignored
kubeEtcd:
  enabled: true
# @ignored
kubelet:
  enabled: true
# @ignored
kubeProxy:
  enabled: true
# @ignored
kubeScheduler:
  enabled: true
# @ignored
prometheusOperator:
  kubeletService: {}
# @ignored
windowsMonitoring: {}

## custom Rules to override "for" and "severity" in defaultRules
##
# @ignored
customRules: {}
  # AlertmanagerFailedReload:
  #   for: 3m
  # AlertmanagerMembersInconsistent:
  #   for: 5m
  #   severity: "warning"

## Create default rules for monitoring the cluster
##
# @ignored
defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: true
    configReloaders: true
    clusterApi: true
    general: true
    k8sContainerCpuUsageSecondsTotal: true
    k8sContainerMemoryCache: true
    k8sContainerMemoryRss: true
    k8sContainerMemorySwap: true
    k8sContainerResource: true
    k8sContainerMemoryWorkingSetBytes: true
    k8sPodOwner: true
    kubeApiserverAvailability: true
    kubeApiserverBurnrate: true
    kubeApiserverHistogram: true
    kubeApiserverSlos: true
    kubeControllerManager: true
    kubelet: true
    kubeProxy: true
    kubePrometheusGeneral: true
    kubePrometheusNodeRecording: true
    kubernetesApps: true
    kubernetesResources: true
    kubernetesStorage: true
    kubernetesSystem: true
    kubeSchedulerAlerting: true
    kubeSchedulerRecording: true
    kubeStateMetrics: true
    mothershipControlPlane: true
    network: true
    node: true
    nodeExporterAlerting: true
    nodeExporterRecording: true
    prometheus: true
    prometheusOperator: true
    windows: true

  ## Reduce app namespace alert scope
  appNamespacesTarget: ".*"

  ## Set keep_firing_for for all alerts
  keepFiringFor: ""

  ## Labels for default rules
  labels: {}
  ## Annotations for default rules
  annotations: {}

  ## Additional labels for PrometheusRule alerts
  additionalRuleLabels: {}

  ## Additional annotations for PrometheusRule alerts
  additionalRuleAnnotations: {}

  ## Additional labels for specific PrometheusRule alert groups
  additionalRuleGroupLabels:
    alertmanager: {}
    etcd: {}
    configReloaders: {}
    clusterApi: {}
    general: {}
    k8sContainerCpuUsageSecondsTotal: {}
    k8sContainerMemoryCache: {}
    k8sContainerMemoryRss: {}
    k8sContainerMemorySwap: {}
    k8sContainerResource: {}
    k8sPodOwner: {}
    kubeApiserverAvailability: {}
    kubeApiserverBurnrate: {}
    kubeApiserverHistogram: {}
    kubeApiserverSlos: {}
    kubeControllerManager: {}
    kubelet: {}
    kubeProxy: {}
    kubePrometheusGeneral: {}
    kubePrometheusNodeRecording: {}
    kubernetesApps: {}
    kubernetesResources: {}
    kubernetesStorage: {}
    kubernetesSystem: {}
    kubeSchedulerAlerting: {}
    kubeSchedulerRecording: {}
    kubeStateMetrics: {}
    mothershipControlPlane: {}
    network: {}
    node: {}
    nodeExporterAlerting: {}
    nodeExporterRecording: {}
    prometheus: {}
    prometheusOperator: {}

  ## Additional annotations for specific PrometheusRule alerts groups
  additionalRuleGroupAnnotations:
    alertmanager: {}
    etcd: {}
    configReloaders: {}
    clusterApi: {}
    general: {}
    k8sContainerCpuUsageSecondsTotal: {}
    k8sContainerMemoryCache: {}
    k8sContainerMemoryRss: {}
    k8sContainerMemorySwap: {}
    k8sContainerResource: {}
    k8sPodOwner: {}
    kubeApiserverAvailability: {}
    kubeApiserverBurnrate: {}
    kubeApiserverHistogram: {}
    kubeApiserverSlos: {}
    kubeControllerManager: {}
    kubelet: {}
    kubeProxy: {}
    kubePrometheusGeneral: {}
    kubePrometheusNodeRecording: {}
    kubernetesApps: {}
    kubernetesResources: {}
    kubernetesStorage: {}
    kubernetesSystem: {}
    kubeSchedulerAlerting: {}
    kubeSchedulerRecording: {}
    kubeStateMetrics: {}
    mothershipControlPlane: {}
    network: {}
    node: {}
    nodeExporterAlerting: {}
    nodeExporterRecording: {}
    prometheus: {}
    prometheusOperator: {}

  additionalAggregationLabels: []

  ## Prefix for runbook URLs. Use this to override the first part of the runbookURLs that is common to all rules.
  runbookUrl: "https://runbooks.prometheus-operator.dev/runbooks"

  node:
    fsSelector: 'fstype!=""'
    # fsSelector: 'fstype=~"ext[234]|btrfs|xfs|zfs"'

  ## Disabled PrometheusRule alerts
  disabled: {}

  # KubeAPIDown: true
  # NodeRAIDDegraded: true

## Create default rules for monitoring the cluster
##
# @ignored
mothershipRules:
  create: true
  rules:
    controlPlane: true

  ## Reduce app namespace alert scope
  appNamespacesTarget: ".*"

  ## Set keep_firing_for for all alerts
  keepFiringFor: ""

  ## Labels for default rules
  labels: {}
  ## Annotations for default rules
  annotations: {}

  ## Additional labels for PrometheusRule alerts
  additionalRuleLabels: {}

  ## Additional annotations for PrometheusRule alerts
  additionalRuleAnnotations: {}

  ## Additional labels for specific PrometheusRule alert groups
  additionalRuleGroupLabels:
    controlPlane: {}

  ## Additional annotations for specific PrometheusRule alerts groups
  additionalRuleGroupAnnotations:
    controlPlane: {}

  additionalAggregationLabels: []

  ## Prefix for runbook URLs. Use this to override the first part of the runbookURLs that is common to all rules.
  runbookUrl: "https://docs.k0rdent.io/next/admin/kof/"

  ## Endpoint of Cluster API dashboard in Grafana
  clusterApiDashboardPath: "/d/f782099f-f732-4d48-80ed-5fb7d9148d9f"

# -- Cluster-specific patch of Prometheus alerting rules,
# e.g. `cluster1.alertgroup1.alert1.expr` overriding the threshold `> ( 25 / 100 )`
# and adding `{cluster="cluster1"}` filter, or just adding whole new rules
clusterAlertRules: {}
  # cluster1:
  #   kubernetes-resources:
  #     CPUThrottlingHigh:
  #       expr: |-
  #         sum by(cluster, namespace, node, pod, container) (increase(container_cpu_cfs_throttled_periods_total{cluster="cluster1", container!="", job="kubelet", metrics_path="/metrics/cadvisor", }[5m]))
  #           /
  #         sum by(cluster, namespace, node, pod, container) (increase(container_cpu_cfs_periods_total{cluster="cluster1", job="kubelet", metrics_path="/metrics/cadvisor", }[5m]))
  #           > 0.42

# -- Patch of default Prometheus alerting rules,
# e.g. `alertgroup1.alert1` overriding `for` field and adding
# `{cluster!~"^cluster1$|^cluster10$"}` for rules overridden in `clusterRulesPatch`,
# or just adding whole new rules
defaultAlertRules:
  # kubernetes-resources:
  #   CPUThrottlingHigh:
  #     for: 10m
  #     expr: |-
  #       sum by(cluster, namespace, node, pod, container) (increase(container_cpu_cfs_throttled_periods_total{cluster!~"^cluster1$|^cluster10$", container!="", job="kubelet", metrics_path="/metrics/cadvisor", }[5m]))
  #         /
  #       sum by(cluster, namespace, node, pod, container) (increase(container_cpu_cfs_periods_total{cluster!~"^cluster1$|^cluster10$", job="kubelet", metrics_path="/metrics/cadvisor", }[5m]))
  #         > 0.25
  #
  # New rule based on https://github.com/samber/awesome-prometheus-alerts/blob/2025-04-17.1/dist/rules/docker-containers/google-cadvisor.yml#L34
  # adapted for multi-cluster case:
  docker-containers:
    ContainerHighMemoryUsage:
      expr: |-
        sum(container_memory_working_set_bytes{pod!=""}) by (cluster, namespace, pod, container)
        / sum(container_spec_memory_limit_bytes > 0) by (cluster, namespace, pod, container) * 100
        > 80
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: Container High Memory usage ({{ $labels.cluster }}/{{ $labels.namespace }}/{{ $labels.pod }}/{{ $labels.container }})
        description: "Container Memory usage is above 80%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
  kube-state-metrics:
    ConditionStatusFailed:
      expr: '{customresource_group="k0rdent.mirantis.com", job="kube-state-metrics"} == 0'
      for: 10m
      labels:
        severity: error
      annotations:
        summary: k0rdent custom resource condition status failed ({{ $labels.cluster }}/{{ $labels.name }})
        description: "LABELS = {{ $labels }}"

# -- Cluster-specific patch of Prometheus recording rules,
# e.g. `regionalCluster1.recordGroup1` overriding whole group of rules
# (because `record` is not unique), or adding new groups
clusterRecordRules: {}
  # regional1:
  #   kube-prometheus-general.rules:
  #     - expr: count without(instance, pod, node) (up == 1)
  #       record: count:up1
  #     - expr: count without(instance, pod, node) (up == 0)
  #       record: count:up0
  #     - expr: count without(instance, pod, node) (up{cluster="child2"} >= 0)
  #       record: count:child2_up_or_down

# -- Patch of default Prometheus recording rules,
# e.g. `recordgroup1` overriding whole group of rules (`record` is not unique),
# or adding new groups
defaultRecordRules: {}
  # kube-prometheus-general.rules:
  #   - expr: count without(instance, pod, node) (up == 1)
  #     record: count:up1
  #   - expr: count without(instance, pod, node) (up == 0)
  #     record: count:up0
  #   - expr: count without(instance, pod, node) (up <= 1)
  #     record: count:up_or_down
  # kube-prometheus-general-default-test.rules:
  #   - expr: count without(instance, pod, node) (up >= 0)
  #     record: count:up_or_down
