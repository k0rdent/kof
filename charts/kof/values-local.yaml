# Example values for local KOF deployment with storage and collectors
# This configuration is suitable for development and testing on a local kind cluster

global:
  helmRepo:
    name: kcm-templates
    kofManaged:
      enabled: false
  storageClass: ""

kof-operators:
  values:
    grafana-operator:
      enabled: true

# Install mothership components (management cluster)
kof-mothership:
  values:
    global:
      registry: ""
    kcm:
      kof:
        operator:
          image:
            registry: docker.io/library
            repository: kof-operator-controller
        acl:
          enabled: true
          developmentMode: true
          extraArgs:
            issuer: https://dex.example.com:32000
            admin-email: admin@example.com
          image:
            registry: docker.io/library
            repository: kof-acl-server
    victoriametrics:
      vmcluster:
        spec:
          retentionPeriod: "7d"
          replicationFactor: 1
          vmstorage:
            replicaCount: 1
            storage:
              volumeClaimTemplate:
                spec:
                  resources:
                    requests:
                      storage: 10Gi
          vmselect:
            replicaCount: 1
          vminsert:
            replicaCount: 1

      kof:
        mcs:
          kof-aws-dns-secrets:
            matchLabels:
              k0rdent.mirantis.com/kof-aws-dns-secrets: "true"
            secrets:
              - external-dns-aws-credentials
    dex:
      enabled: true
      config:
        issuer: https://dex.example.com:32000
        connectors: []
        enablePasswordDB: true
        staticPasswords:
          - email: "admin@example.com"
            hash: ""
            username: "admin"
            userID: "1"
        oauth2:
          passwordConnector: local
        staticClients:
          - id: grafana-id
            redirectURIs:
              - "http://localhost:3000/login/generic_oauth"
            name: Grafana
            secret: grafana-secret

        # Example OIDC connector configuration for Google with multi-tenancy support
        # connectors:
        #   - type: oidc
        #     id: google
        #     name: Google
        #     config:
        #       issuer: https://accounts.google.com
        #       clientID: ""
        #       clientSecret: ""
        #       redirectURI: https://dex.example.com:32000/callback
        #       insecureEnableGroups: true
        #       claimModifications:
        #         newGroupFromClaims:
        #         - prefix: "tenant"
        #           delimiter: ":"
        #           clearDelimiter: false
        #           claims:
        #             - hd
        #       scopes:
        #         - openid
        #         - email
        #         - profile

    promxy:
      replicaCount: 1

    # Enable Grafana for local development
    grafana:
      installForTests: true
      enabled: true
      security:
        create_secret: true

    # Enable metrics-server for local kind cluster
    metrics-server:
      enabled: true
      args:
        - "--kubelet-insecure-tls"

    kube-state-metrics:
      enabled: true

    dex:
      config:
        # -- The identifier (issuer) URL for Dex.
        issuer: "https://dex.example.com:32000"

        staticClients:
          - id: grafana-id
            redirectURIs:
              - "http://localhost:3000/login/generic_oauth"
            name: "Grafana"
            secret: grafana-secret

# KOF Regional - MultiClusterService template for regional clusters
kof-regional:
  values:
    storage:
      victoriametrics:
        vmcluster:
          spec:
            vmstorage:
              storage:
                volumeClaimTemplate:
                  spec:
                    resources:
                      requests:
                        storage: 10Gi
      victoria-logs-cluster:
        vlstorage:
          persistentVolume:
            size: 10Gi
      victoria-traces-cluster:
        vtstorage:
          persistentVolume:
            size: 10Gi

# Enable local storage components
kof-storage:
  enabled: true
  values:
    victoria-metrics-operator:
      enabled: false

    victoriametrics:
      enabled: false
      vmcluster:
        enabled: true
        spec:
          retentionPeriod: "7d"
          replicationFactor: 1
          vmstorage:
            replicaCount: 1
            storage:
              volumeClaimTemplate:
                spec:
                  resources:
                    requests:
                      storage: 10Gi

    victoria-logs-cluster:
      enabled: true
      vlstorage:
        persistentVolume:
          size: 10Gi

    victoria-traces-cluster:
      enabled: true
      vtstorage:
        persistentVolume:
          size: 10Gi

    grafana:
      enabled: false

# Enable collectors for local deployment
kof-collectors:
  enabled: true
  values:
    collectors:
      enabled: true
      kcm:
        monitoring: true
    opentelemetry-kube-stack:
      clusterName: mothership
      defaultCRConfig:
        env:
          - name: PKI_PATH
            value: etc/kubernetes
        config:
          processors:
            resource/k8sclustername:
              attributes:
                - action: insert
                  key: k8s.cluster.name
                  value: mothership
                - action: insert
                  key: k8s.cluster.namespace
                  value: kcm-system
          exporters:
            prometheusremotewrite:
              external_labels:
                cluster: mothership
                clusterNamespace: kcm-system
    opencost:
      enabled: true

    metrics-server:
      enabled: false
